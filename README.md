## Privacy-preserving TEE protoype on a service-oriented environment

***

# Usage:

## build libelf

We use the libelf from the elfutils (https://sourceware.org/elfutils/). By default it will generate a static library.

```
git clone https://github.com/StanPlatinum/elfutils4sgx.git
cd elfutils4sgx/elfutils-0.176
autoheader
aclocal -I m4
autoconf
automake -a -c
./configure
make
```

## build capstone

Capstone can be cloned at https://github.com/aquynh/capstone. Capstone by default will generate a static library (capstone.a). To reduce program size, you can configure Capstone to only build x86 instruction decoding support.

```
git clone https://github.com/StanPlatinum/capstone.git
cd capstone
mkdir build
mkdir install-x86
cd build
cmake .. -DCMAKE_INSTALL_PREFIX=../install-x86 -DCAPSTONE_ARCHITECTURE_DEFAULT=OFF -DCAPSTONE_X86_SUPPORT=1
make & make install
```

## build libz

libz is typically already installed in system directory. In case libz.a is not installed, it can be generated by compiling from source (https://zlib.net/).

## build llvm/clang

```
git clone https://github.com/StanPlatinum/llvm-project.git
cd llvm-project
mkdir build && cd build
cmake -G 'Unix Makefiles' ../llvm -DLLVM_ENABLE_PROJECTS=clang -DLLVM_TARGETS_TO_BUILD="X86"
make
```

## generate target binary

```
cd ..
cd dynamic-loader/target-program
make
```

## build loader

```
cd ..
```

### copy dependencies to Enclave/TrustedLib

```
cp elfutils4sgx/elfutils-0.176/libelf/libelf.a Enclave/TrustedLib
```

### set variables in Makefile

```
make
```
