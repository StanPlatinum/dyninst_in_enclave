## Privacy-preserving TEE protoype on a service-oriented environment

***

# Usage:

## build linux-sgx and linux-sgx-driver

Please refer to https://github.com/intel/linux-sgx and https://github.com/intel/linux-sgx-driver.

Make sure the SGXSDK version is 2.5 or later.

## build libelf

We use the libelf from the elfutils (https://sourceware.org/elfutils/). By default it will generate a static library.

```
git clone https://github.com/StanPlatinum/elfutils4sgx.git
cd elfutils4sgx/elfutils-0.176
autoheader
aclocal -I m4
autoconf
automake -a -c
./configure
make
```

## build capstone

Capstone can be cloned at https://github.com/aquynh/capstone. Capstone by default will generate a static library (capstone.a). To reduce program size, you can configure Capstone to only build x86 instruction decoding support.

```
git clone https://github.com/StanPlatinum/capstone.git
cd capstone
mkdir build
mkdir install-x86
cd build
cmake .. -DCMAKE_INSTALL_PREFIX=../install-x86 -DCAPSTONE_ARCHITECTURE_DEFAULT=OFF -DCAPSTONE_X86_SUPPORT=1
make & make install
```

## build libz

libz is typically already installed in system directory. In case libz.a is not installed, it can be generated by compiling from source (https://zlib.net/).

## build llvm/clang

```
git clone https://github.com/StanPlatinum/llvm-project.git
cd llvm-project
mkdir build && cd build
cmake -G 'Unix Makefiles' ../llvm -DLLVM_ENABLE_PROJECTS=clang -DLLVM_TARGETS_TO_BUILD="X86"
make
```

## generate target binary

Please modify $(SGX_Shield_PATH) to where the SGX-Shield is cloned.

```
cd ..
cd dynamic-loader/target-program
make
```

## build loader

```
cd ..
```

### copy dependencies to Enclave/TrustedLib

```
cp elfutils4sgx/elfutils-0.176/libelf/libelf.a Enclave/TrustedLib
cp capstone/install-x86/lib/libcapstone.a Enclave/TrustedLib
```

Please note that at this time some necessary libs have been copied into the dir Enclave/TrustedLib.

### set variables in Makefile

```
cd dynamic-loader-checker
vi Makefile
```

Please modify $(SGX_SRC_PATH) to where the SGXSDK is installed.
And set $(ELFUTILS_PATH) and $(CAPSTONE_PATH) to where the elfutils and capstone have been installed respectively.

### build

```
make
```
